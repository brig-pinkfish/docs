---
title: "MCP Protocol"
description: "JSON-RPC 2.0 format, servers, and tools"
---

The MCP Farm implements the Model Context Protocol (MCP) over HTTP. All requests are HTTP POST with JSON-RPC 2.0 payloads.

**Base URL:** `https://mcp.app.pinkfish.ai`

Requires a runtime token. See [Authentication](/api-reference/platform/authentication).

## Request Flow

| You know...     | Use                                                                                                                    |
| --------------- | ---------------------------------------------------------------------------------------------------------------------- |
| Tool and server | `tools/call` on the server path (e.g., `/web-search`, `/gmail`)                                                        |
| Task, not tool  | [Discovery](/api-reference/platform/discovery): `capabilities_discover` → `capability_details` → call recommended tool |

## Request Format

All requests use this structure:

```bash
curl -s -X POST "https://mcp.app.pinkfish.ai/<server-path>" \
  -H "Authorization: Bearer $PINKFISH_TOKEN" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "<method>",
    "params": {
      "name": "<tool_name>",
      "arguments": { ... }
    },
    "id": 1
  }'
```

**Required headers:**

| Header          | Value                    |
| --------------- | ------------------------ |
| `Authorization` | `Bearer <runtime_token>` |
| `Content-Type`  | `application/json`       |
| `Accept`        | `application/json`       |

**JSON-RPC fields:**

| Field     | Description                                                                                     |
| --------- | ----------------------------------------------------------------------------------------------- |
| `jsonrpc` | Always `"2.0"`                                                                                  |
| `method`  | The JSON-RPC method — typically `"tools/call"` or `"tools/list"`                                |
| `params`  | Method parameters — for `tools/call`, includes `name` (tool name) and `arguments` (tool inputs) |
| `id`      | Request identifier (any integer)                                                                |

## List Servers

Query available servers and their tools:

```bash
curl -s -X POST "https://mcp.app.pinkfish.ai/mcp" \
  -H "Authorization: Bearer $PINKFISH_TOKEN" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/call",
    "params": {
      "name": "listServers",
      "arguments": {}
    },
    "id": 1
  }'
```

**Response:** Returns `result.structuredContent` (preferred) or `result.content[0].text` (JSON string). See [Response Format](#response-format) below.

Each server entry includes:

| Field         | Description                                                                               |
| ------------- | ----------------------------------------------------------------------------------------- |
| `name`        | Server identifier (e.g., `gmail`, `slack`, `datastore-structured`)                        |
| `path`        | URL path to call this server (e.g., `/gmail`)                                             |
| `description` | What the server does                                                                      |
| `embedded`    | `true` = built-in platform service, `false` = external application requiring a connection |
| `tools`       | Array of tools provided by this server                                                    |

## List Tools

Call `tools/list` on a server path to see its tools:

```bash
curl -s -X POST "https://mcp.app.pinkfish.ai/gmail" \
  -H "Authorization: Bearer $PINKFISH_TOKEN" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/list",
    "id": 1
  }'
```

**Response:**

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "tools": [
      {
        "name": "gmail_search_emails",
        "description": "Search emails in Gmail",
        "inputSchema": {
          "type": "object",
          "properties": {
            "PCID": {
              "type": "string",
              "description": "PinkConnect connection ID"
            },
            "query": { "type": "string", "description": "Gmail search query" }
          },
          "required": ["PCID", "query"]
        }
      }
    ]
  }
}
```

Each tool includes an `inputSchema` (JSON Schema) for its parameters.

## Call a Tool

POST `tools/call` to the server path with the tool name and arguments:

```bash
curl -s -X POST "https://mcp.app.pinkfish.ai/<server-path>" \
  -H "Authorization: Bearer $PINKFISH_TOKEN" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/call",
    "params": {
      "name": "<tool_name>",
      "arguments": {
        "key": "value"
      }
    },
    "id": 1
  }'
```

### Example: Search the Web

```bash
curl -s -X POST "https://mcp.app.pinkfish.ai/web-search" \
  -H "Authorization: Bearer $PINKFISH_TOKEN" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/call",
    "params": {
      "name": "search_googlesearch",
      "arguments": {
        "query": "latest AI news"
      }
    },
    "id": 1
  }'
```

**Response:** `result.structuredContent` or `result.content[0].text`. See [Response Format](#response-format).

### Example: External Service (Gmail)

Application tools (Gmail, Slack, etc.) require a `PCID`. See [Connections](/api-reference/platform/connections).

```bash
curl -s -X POST "https://mcp.app.pinkfish.ai/gmail" \
  -H "Authorization: Bearer $PINKFISH_TOKEN" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "tools/call",
    "params": {
      "name": "gmail_search_emails",
      "arguments": {
        "PCID": "abc123-def456",
        "query": "is:unread"
      }
    },
    "id": 1
  }'
```

## Response Format

### Success

| Format                     | Field                      | Use                                     |
| -------------------------- | -------------------------- | --------------------------------------- |
| **Structured** (preferred) | `result.structuredContent` | Type-safe object. No parsing.           |
| **Legacy**                 | `result.content[0].text`   | JSON string. Parse with `JSON.parse()`. |

Prefer `structuredContent` when present; fall back to `content[0].text` for compatibility.

```javascript
const data =
  result.structuredContent ?? JSON.parse(result?.content?.[0]?.text ?? "{}");
```

**Optional `X-MCP-Mode` header:** `optimized` (structured only) or `legacy` (legacy only). Omit for both.

### Errors

| Code     | Meaning                                                    |
| -------- | ---------------------------------------------------------- |
| `-32000` | Server error — validation, timeout, unsupported media type |
| `-32603` | Internal error                                             |

The `message` field contains a human-readable description. Common `-32000` causes: missing `Accept: application/json`, missing `Content-Type: application/json`, or request body too large.
